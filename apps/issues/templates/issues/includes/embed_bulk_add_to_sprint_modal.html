{% load i18n %}
<div class="modal" :class="{ 'modal-open': showBulkAddToSprintModal }" @keydown.escape="showBulkAddToSprintModal = false">
  <div class="modal-box">
    <h3 class="font-bold text-lg mb-4">{% translate "Add to Sprint" %}</h3>
    <input type="hidden" name="sprint" :value="selectedSprintValue" id="embed-bulk-sprint-value">
    <div x-show="!sprintConfirmStep" x-cloak>
      <p class="mb-4">{% translate "Select a sprint for the selected issues:" %}</p>
      {% if available_sprints %}
      <div class="form-control">
        {% for available_sprint in available_sprints %}
        <label class="label cursor-pointer justify-start gap-3">
          <input type="radio" name="embed-sprint-select" class="radio radio-primary" value="{{ available_sprint.key }}"
                 {% if forloop.first %}checked{% endif %}
                 @change="selectedSprintName = '{{ available_sprint.name }}'; selectedSprintValue = '{{ available_sprint.key }}'">
          <div class="flex items-center gap-2">
            <span class="font-mono text-sm">{{ available_sprint.key }}</span>
            <span>{{ available_sprint.name }}</span>
            {% include "sprints/includes/sprint_status_badge.html" with status=available_sprint.status status_display=available_sprint.get_status_display %}
          </div>
        </label>
        {% endfor %}
      </div>
      <div class="modal-action">
        <button class="btn btn-ghost" @click="showBulkAddToSprintModal = false">{% translate "Cancel" %}</button>
        <button class="btn btn-primary" @click="sprintConfirmStep = true">{% translate "Continue" %}</button>
      </div>
      {% else %}
      <p class="text-gray-500 py-4">{% translate "No active or planning sprints available." %}</p>
      <div class="modal-action">
        <button class="btn btn-ghost" @click="showBulkAddToSprintModal = false">{% translate "Close" %}</button>
      </div>
      {% endif %}
    </div>
    <div x-show="sprintConfirmStep" x-cloak>
      <p class="mb-4">
        {% blocktranslate %}Add selected issues to:{% endblocktranslate %}
        <strong x-text="selectedSprintName"></strong>
      </p>
      <div class="modal-action">
        <button class="btn btn-ghost" @click="sprintConfirmStep = false">{% translate "Back" %}</button>
        <button class="btn btn-primary"
                hx-post="{% url 'workspace_issues_bulk_add_to_sprint' workspace.slug %}"
                hx-vals='{% if epic %}{"page": "{{ page_obj.number|default:1 }}", "search": "{{ search_query|default:"" }}", "status_filter": "{{ status_filter|default:"" }}", "assignee_filter": "{{ assignee_filter|default:"" }}", "group_by": "{{ group_by|default:"" }}", "project_filter": "{{ project.key }}", "epic_filter": "{{ epic.key }}", "embed": "epic"}{% elif milestone %}{"page": "{{ page_obj.number|default:1 }}", "search": "{{ search_query|default:"" }}", "status_filter": "{{ status_filter|default:"" }}", "assignee_filter": "{{ assignee_filter|default:"" }}", "group_by": "{{ group_by|default:"" }}", "project_filter": "{{ project.key }}", "milestone_filter": "{{ milestone.key }}", "embed": "milestone"}{% elif project_orphan %}{"page": "{{ page_obj.number|default:1 }}", "search": "{{ search_query|default:"" }}", "status_filter": "{{ status_filter|default:"" }}", "type_filter": "{{ type_filter|default:"" }}", "priority_filter": "{{ priority_filter|default:"" }}", "assignee_filter": "{{ assignee_filter|default:"" }}", "sprint_filter": "{{ sprint_filter|default:"" }}", "group_by": "{{ group_by|default:"" }}", "project_filter": "{{ project.key }}", "embed": "project_orphan"}{% endif %}'
                hx-include="#issues-embed [name='issues']:checked, #embed-bulk-sprint-value"
                hx-target="#issues-embed"
                hx-swap="innerHTML"
                hx-indicator="#embed-list-loading"
                @click="showBulkAddToSprintModal = false">
          {% translate "Add to Sprint" %}
        </button>
      </div>
    </div>
  </div>
  <div class="modal-backdrop" @click="showBulkAddToSprintModal = false"></div>
</div>
