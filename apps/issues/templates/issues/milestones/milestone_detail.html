{% extends "apps/base.html" %}
{% load i18n %}
{% block app %}
<div id="page-content" hx-target="#page-content">
  {% partialdef page-content inline %}
  <section class="app-card" x-data="{ showDeleteModal: false, showCascadeModal: false }">
    {% include "issues/includes/milestone_detail_header.html" %}

    {# Issues and History Tabs #}
    <div class="mt-6" x-data="{ activeTab: 'issues' }">
      <div role="tablist" class="tabs tabs-lift">
        <button role="tab" class="tab" :class="{ 'tab-active': activeTab === 'issues' }"
                @click="activeTab = 'issues'">
          {% translate "Issue Hierarchy" %}
        </button>
        <button role="tab" class="tab" :class="{ 'tab-active': activeTab === 'history' }"
                @click="activeTab = 'history'">
          {% translate "History" %}
        </button>
        <div class="tab flex-1 cursor-default"></div>
      </div>

      <div class="border border-base-300 border-t-0 rounded-b-box p-4">
        {# Issues tab content #}
        <div x-show="activeTab === 'issues'">
          {# HTMX-loaded embedded issues list #}
          <div hx-get="{% url 'milestones:milestone_issues_embed' workspace.slug milestone.project.key milestone.key %}?group_by=epic"
               hx-trigger="load"
               hx-target="this"
               hx-swap="innerHTML">
            <div class="flex justify-center py-8">
              <span class="loading loading-spinner loading-md"></span>
            </div>
          </div>
        </div>

        {# History tab content #}
        <div x-show="activeTab === 'history'" x-cloak>
          <div id="history-section"
               hx-get="{% url 'milestones:milestone_history' workspace.slug milestone.project.key milestone.key %}"
               hx-trigger="intersect once"
               hx-target="this"
               hx-swap="innerHTML">
            <span class="loading loading-spinner loading-md"></span>
          </div>
        </div>
      </div>
    </div>
    {% include "includes/delete_confirm_modal.html" with delete_modal_id="detail-delete-modal-content" %}
    {% include "includes/cascade_status_modal.html" %}
  </section>
  {% endpartialdef page-content %}
</div>
{% endblock %}
