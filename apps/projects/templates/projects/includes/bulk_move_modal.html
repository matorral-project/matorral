{% load i18n %}
<div class="modal" :class="{ 'modal-open': showBulkMoveModal }" role="dialog" aria-modal="true" aria-labelledby="bulk-move-modal-title">
  <div class="modal-box">
    <h3 id="bulk-move-modal-title" class="font-bold text-lg">{% translate "Move Projects to Workspace" %}</h3>
    <input type="hidden" name="workspace" id="move-workspace-hidden" :value="selectedMoveWorkspaceValue">

    {# Step 1: Workspace selection #}
    <div x-show="!moveConfirmStep">
      <p class="py-4">
        {% blocktranslate trimmed %}
          Select a workspace to move the selected projects to.
        {% endblocktranslate %}
      </p>
      <p class="text-sm text-base-content/70 mb-4" x-text="selectedCount + ' {% translate "project(s) will be moved" %}'"></p>
      <div class="max-h-60 overflow-y-auto border border-base-300 rounded-lg">
        <ul class="menu p-2">
          {% for ws in move_target_workspaces %}
          <li>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="radio" name="move-workspace-selection" value="{{ ws.pk }}" class="radio radio-sm"
                     data-label="{{ ws.name }}">
              <span>{{ ws.name }}</span>
            </label>
          </li>
          {% empty %}
          <li class="text-base-content/50 italic p-2">{% translate "No other workspaces available." %}</li>
          {% endfor %}
        </ul>
      </div>
      <div class="modal-action">
        <button type="button"
                class="btn btn-primary"
                @click="
                  let selected = document.querySelector('[name=move-workspace-selection]:checked');
                  if (!selected) return;
                  selectedMoveWorkspaceName = selected.dataset.label;
                  selectedMoveWorkspaceValue = selected.value;
                  moveConfirmStep = true;
                ">
          {% translate "Continue" %}
        </button>
        <button type="button" class="btn" @click="showBulkMoveModal = false">
          {% translate "Cancel" %}
        </button>
      </div>
    </div>

    {# Step 2: Confirmation #}
    <div x-show="moveConfirmStep" x-cloak>
      <p class="py-4">
        {% blocktranslate trimmed %}
          Are you sure you want to move the selected projects?
        {% endblocktranslate %}
      </p>
      <div class="bg-base-200 rounded-lg p-4 my-2">
        <p class="text-sm text-base-content/70">{% translate "Destination workspace" %}</p>
        <p class="font-semibold" x-text="selectedMoveWorkspaceName"></p>
      </div>
      <div class="alert alert-warning mt-3">
        <i class="fa fa-triangle-exclamation"></i>
        <p class="text-sm">
          {% blocktranslate trimmed %}
            All work items will be removed from their current sprints. This action cannot be undone.
          {% endblocktranslate %}
        </p>
      </div>
      <p class="text-sm text-base-content/70 mt-3" x-text="selectedCount + ' {% translate "project(s) will be moved" %}'"></p>
      <div class="modal-action">
        <button type="button"
                class="btn btn-primary"
                hx-post="{% url 'projects:projects_bulk_move' workspace.slug %}"
                hx-vals='{"page": "{{ page_obj.number|default:1 }}", "search": "{{ search_query|default:"" }}", "status_filter": "{{ status_filter|default:"" }}", "lead_filter": "{{ lead_filter|default:"" }}", "group_by": "{{ group_by|default:"" }}"}'
                hx-include="[name='projects']:checked, #move-workspace-hidden"
                hx-swap="none"
                hx-indicator="#list-loading"
                hx-disabled-elt="this"
                @click="confirmBulkMove()">
          {% translate "Confirm Move" %}
        </button>
        <button type="button" class="btn" @click="moveConfirmStep = false">
          {% translate "Back" %}
        </button>
      </div>
    </div>
  </div>
  <div class="modal-backdrop" @click="showBulkMoveModal = false; moveConfirmStep = false"></div>
</div>
