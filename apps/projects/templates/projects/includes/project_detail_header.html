{% load i18n %}
{# Display mode for project detail header - click on editable areas triggers edit mode #}
<div id="project-header"
     class="project-detail-header"
     x-data="{ expanded: localStorage.getItem('proj_{{ project.pk }}_expanded') !== 'false', showMoveModal: false, moveProjectConfirmStep: false, moveProjectWorkspaceName: '', moveProjectWorkspaceValue: '' }">
  <div class="flex justify-between items-center mb-4">
    <div class="group flex-1">
      <div class="flex items-center gap-2 mb-1">
        <span class="font-mono text-sm text-gray-500">{{ project.key }}</span>
        <a href="#"
           class="invisible group-hover:visible text-xs link link-primary"
           hx-get="{% url 'projects:project_detail_inline_edit' workspace.slug project.key %}"
           hx-target="#project-header"
           hx-swap="outerHTML"
           @click.prevent>[{% translate "Edit" %}]</a>
      </div>
      <h1 class="mt-title">{{ project.name }}</h1>
    </div>
    <div class="flex items-center gap-3 no-edit">
      {% if progress %}
      <div class="flex items-center gap-2">
        <span class="text-sm font-semibold text-nowrap">{% translate "Progress:" %}</span>
        <div class="w-96">
          {% include "issues/includes/progress_bar.html" with progress=progress hide_labels=True %}
        </div>
      </div>
      {% endif %}
      {% include "projects/includes/project_status_badge.html" with status=project.status status_display=project.get_status_display %}
      <button type="button"
              class="btn btn-sm btn-ghost btn-square"
              @click.stop="expanded = !expanded; localStorage.setItem('proj_{{ project.pk }}_expanded', expanded)"
              :title="expanded ? '{% translate "Collapse details" %}' : '{% translate "Expand details" %}'">
        <i class="fa transition-transform duration-200" :class="expanded ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
      </button>
      <div class="dropdown dropdown-end">
        <div tabindex="0" role="button" class="btn btn-sm btn-ghost btn-square">
          <i class="fa fa-ellipsis-vertical"></i>
        </div>
        <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-10 w-40 p-2 shadow">
          <li>
            <button type="button" @click="$refs.cloneForm.submit()">
              <i class="fa fa-clone"></i> {% translate "Clone" %}
            </button>
          </li>
          {% if move_target_workspaces %}
          <li>
            <button type="button"
                    @click="moveProjectConfirmStep = false; moveProjectWorkspaceName = ''; moveProjectWorkspaceValue = ''; showMoveModal = true; document.activeElement.blur()">
              <i class="fa fa-arrow-right-arrow-left"></i> {% translate "Move" %}
            </button>
          </li>
          {% endif %}
          <li>
            <button type="button" class="text-error"
                    hx-get="{% url 'projects:project_delete' workspace.slug project.key %}"
                    hx-target="#detail-delete-modal-content"
                    hx-swap="innerHTML"
                    @click="showDeleteModal = true; document.activeElement.blur()">
              <i class="fa fa-trash"></i> {% translate "Delete" %}
            </button>
          </li>
        </ul>
      </div>
      <form x-ref="cloneForm"
            action="{% url 'projects:project_clone' workspace.slug project.key %}"
            method="post" class="hidden">
        {% csrf_token %}
      </form>
    </div>
  </div>
  {% include "projects/includes/move_modal.html" %}

  <div class="mb-4" x-show="expanded">
    <h3 class="font-semibold mb-2">{% translate "Description" %}</h3>
    {% if project.description %}
    <p class="text-sm text-gray-600 whitespace-pre-wrap [&_a]:text-primary [&_a]:underline">{{ project.description|urlize }}</p>
    {% else %}
    <p class="text-sm text-gray-400 italic">{% translate "No description" %}</p>
    {% endif %}
  </div>

  <div class="grid grid-cols-2 gap-4 mb-4" x-show="expanded">
    <div>
      <h3 class="font-semibold mb-2">{% translate "Lead" %}</h3>
      {% if project.lead %}
      <p class="text-sm text-gray-600">{{ project.lead.get_display_name }}</p>
      {% else %}
      <span class="text-gray-400">—</span>
      {% endif %}
    </div>
    <div class="no-edit">
      <h3 class="font-semibold mb-2">{% translate "Creator" %}</h3>
      {% if project.created_by %}
        <p class="text-sm text-gray-600">{{ project.created_by.get_display_name }}</p>
      {% else %}
        <span class="text-gray-400">—</span>
      {% endif %}
    </div>
  </div>
</div>
