{% extends "base.html" %}
{% load i18n %}
{% block body %}
<section class="mt-7 section">
  <div class="container">
    <div class="mt-columns mt-align-items-center">
      <div class="mt-column">
        {% if not invitation.is_accepted %}
          <h1 class="mt-title">{% translate "Accept Invitation?" %}</h1>
          <h2 class="mt-subtitle">
            {% blocktranslate trimmed with workspace_name=invitation.workspace.name by=invitation.invited_by.get_display_name %}
            You've been invited to join {{ workspace_name }} by {{ by }}.
            {% endblocktranslate %}
          </h2>
          {% if request.user.is_authenticated %}
            {% if user_owns_email and not email_verified %}
              <div>
                <p class="my-2 mt-text-danger">
                  {% blocktranslate trimmed %}
                  You must verify the email address before you can accept the invitation.
                  {% endblocktranslate %}
                </p>
                <a class="mt-button-primary" href="{% url "account_email" %}" hx-boost="true">
                  {% blocktranslate trimmed with email=invitation.email %}
                    Verify {{ email }}
                  {% endblocktranslate %}
                </a>
              </div>
            {% else %}
              <form method="post">
                {% csrf_token %}
                {% if user_owns_email %}
                  <input type="submit" class="mt-button-primary" value="Accept Invitation"/>
                {% else %}
                  <p>
                    {% blocktranslate trimmed with invite_email=invitation.email user_email=request.user.email %}
                    This invitation was sent to {{ invite_email }} but you're logged in as {{ user_email }}.
                    What would you like to do?
                    {% endblocktranslate %}
                  </p>
                  <p class="buttons my-3">
                    <a class="mt-button-primary" href="{% url 'account_email' %}" hx-boost="true">
                      {% blocktranslate trimmed with email=invitation.email %}
                        Add '{{ email }}' to your account
                      {% endblocktranslate %}
                    </a>
                    <a class="mt-button-secondary" href="{% url 'account_logout' %}?invitation_id={{ invitation.id }}" hx-boost="true">
                      {% translate "Sign out" %}
                    </a>
                  </p>
                  <p class="mt-text-muted">
                    {% translate "The email address must be verified before accepting the invitation." %}
                  </p>
                {% endif %}
              </form>
            {% endif %}
            {% if user_workspace_count == 0 %}
            <div class="mt-3">
              <a class="mt-text-muted mt-link" href="{% url 'landing_pages:home' %}" hx-boost="true">
                {% translate "Ignore and go to the home page instead." %}
              </a>
            </div>
            {% endif %}
          {% else %}
            <p class="buttons">
              {% if account_exists %}
                <a class="mt-button-primary" href="{% url 'account_login' %}?next={% url 'workspaces:accept_invitation' invitation.id %}" hx-boost="true">
                  {% translate "Log in to Accept" %}
                </a>
              {% else %}
                <a class="mt-button-primary" href="{% url 'workspaces:signup_after_invite' invitation.id %}" hx-boost="true">
                  {% translate "Create Account to Accept" %}
                </a>
              {% endif %}
            </p>
          {% endif %}
        {% else %}
          <p class="mt-subtitle">
            {% translate "Sorry, it looks like that invitation has already been accepted or expired." %}
          </p>
          <p>
            {% translate "If you think this is a mistake, ask your workspace administrator to invite you again!" %}
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</section>
{% endblock %}
